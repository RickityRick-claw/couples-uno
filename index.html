<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Couples Uno üÉè</title>
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Bangers&family=Permanent+Marker&family=Comic+Neue:wght@400;700&display=swap" rel="stylesheet">
    <style>
        /* ==================== BASE ==================== */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Comic Neue', cursive;
            min-height: 100vh;
            overflow-x: hidden;
            transition: all 0.5s ease;
        }

        /* ==================== SPIDER-VERSE THEME ==================== */
        [data-theme="spiderverse"] {
            --bg-primary: #0d0d1a;
            --bg-secondary: #1a0a2e;
            --primary: #ff00ff;
            --secondary: #00d4ff;
            --accent: #ff1744;
            --text: #ffffff;
            --card-red: #ff1744;
            --card-blue: #00e5ff;
            --card-green: #76ff03;
            --card-yellow: #ffea00;
            --card-wild: linear-gradient(135deg, #ff00ff, #00d4ff, #ff1744, #76ff03);
            --font-display: 'Bangers', cursive;
            --font-body: 'Comic Neue', cursive;
        }
        
        [data-theme="spiderverse"] body {
            background: linear-gradient(180deg, #1a0a2e 0%, #0d0d1a 50%, #2d1b4e 100%);
            position: relative;
            overflow: hidden;
        }
        
        [data-theme="spiderverse"] body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                radial-gradient(ellipse at 20% 80%, rgba(255,0,255,0.15) 0%, transparent 50%),
                radial-gradient(ellipse at 80% 20%, rgba(0,212,255,0.15) 0%, transparent 50%),
                url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><path d="M10,10 Q30,5 50,10 T90,10 M5,30 Q25,25 50,30 T95,30 M15,50 Q35,45 55,50 T85,50 M10,70 Q30,65 50,70 T90,70 M5,90 Q25,85 50,90 T95,90" stroke="rgba(255,255,255,0.03)" fill="none" stroke-width="0.5"/></svg>');
            animation: webPulse 8s ease-in-out infinite;
            pointer-events: none;
            z-index: 0;
        }
        
        @keyframes webPulse {
            0%, 100% { opacity: 0.5; }
            50% { opacity: 1; }
        }
        
        [data-theme="spiderverse"] .screen {
            position: relative;
            z-index: 1;
        }
        
        /* Comic web patterns */
        .spider-web {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 0;
            opacity: 0.1;
            background-image: 
                linear-gradient(45deg, transparent 48%, #fff 48%, #fff 52%, transparent 52%),
                linear-gradient(-45deg, transparent 48%, #fff 48%, #fff 52%, transparent 52%);
            background-size: 60px 60px;
        }

        /* ==================== MILK & MOCHA THEME ==================== */
        [data-theme="milk-mocha"] {
            --bg-primary: #f5e6d3;
            --bg-secondary: #e8d5c4;
            --primary: #8b6914;
            --secondary: #a67c52;
            --accent: #c44569;
            --text: #4a3728;
            --card-red: #c44569;
            --card-blue: #6a89cc;
            --card-green: #78e08f;
            --card-yellow: #f5b041;
            --card-wild: linear-gradient(135deg, #f5e6d3, #c44569, #6a89cc, #78e08f);
            --font-display: 'Permanent Marker', cursive;
        }
        
        [data-theme="milk-mocha"] body {
            background: 
                radial-gradient(circle at 30% 20%, rgba(255,248,240,0.8) 0%, transparent 40%),
                radial-gradient(circle at 70% 80%, rgba(232,213,196,0.6) 0%, transparent 40%),
                linear-gradient(135deg, #f5e6d3 0%, #e8d5c4 100%);
        }
        
        [data-theme="milk-mocha"] body::before {
            content: '‚òï üêª üß∏';
            position: fixed;
            font-size: 15rem;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            opacity: 0.05;
            pointer-events: none;
        }

        /* ==================== ZOOTOPIA THEME ==================== */
        [data-theme="zootopia"] {
            --bg-primary: #1a252f;
            --bg-secondary: #2c3e50;
            --primary: #f39c12;
            --secondary: #e74c3c;
            --accent: #3498db;
            --text: #ecf0f1;
            --card-red: #e74c3c;
            --card-blue: #3498db;
            --card-green: #27ae60;
            --card-yellow: #f39c12;
            --card-wild: linear-gradient(135deg, #e74c3c, #f39c12, #27ae60, #3498db);
            --font-display: 'Bangers', cursive;
        }
        
        [data-theme="zootopia"] body {
            background: linear-gradient(180deg, #2c3e50 0%, #1a252f 100%);
        }
        
        [data-theme="zootopia"] body::before {
            content: 'üåÉ';
            position: fixed;
            font-size: 20rem;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            opacity: 0.03;
            pointer-events: none;
        }

        /* ==================== CLASSIC THEME ==================== */
        [data-theme="classic"] {
            --bg-primary: #1a1a2e;
            --bg-secondary: #16213e;
            --primary: #e94560;
            --secondary: #0f3460;
            --accent: #533483;
            --text: #ffffff;
            --card-red: #e63946;
            --card-blue: #457b9d;
            --card-green: #2a9d8f;
            --card-yellow: #f4a261;
            --card-wild: linear-gradient(135deg, #ff006e, #8338ec, #3a86ff, #06d6a0);
            --font-display: 'Bangers', cursive;
        }
        
        [data-theme="classic"] body {
            background: linear-gradient(135deg, var(--bg-primary) 0%, var(--bg-secondary) 100%);
        }

        /* ==================== ELEMENTS ==================== */
        .screen {
            display: none;
            min-height: 100vh;
            padding: 2rem;
        }
        
        .screen.active {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        /* Character Display */
        .character-showcase {
            position: fixed;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            pointer-events: none;
            z-index: 0;
        }
        
        .character-top {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            text-align: center;
            animation: cheekyBounce 2s ease-in-out infinite;
        }
        
        .character-bottom {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            text-align: center;
        }
        
        .character-img {
            width: 150px;
            height: 150px;
            object-fit: contain;
            filter: drop-shadow(0 10px 30px rgba(0,0,0,0.5));
        }
        
        .character-name {
            font-family: var(--font-display);
            font-size: 1.5rem;
            color: var(--primary);
            text-shadow: 2px 2px 0 #000;
            letter-spacing: 2px;
        }
        
        @keyframes cheekyBounce {
            0%, 100% { transform: translateX(-50%) translateY(0) rotate(-3deg); }
            50% { transform: translateX(-50%) translateY(-10px) rotate(3deg); }
        }

        /* Glitch effect for spiderverse */
        [data-theme="spiderverse"] .character-top {
            animation: glitch 0.3s infinite;
        }
        
        @keyframes glitch {
            0% { transform: translateX(-50%) skew(0deg); }
            20% { transform: translateX(-52%) skew(-2deg); }
            40% { transform: translateX(-48%) skew(2deg); }
            60% { transform: translateX(-50%) skew(-1deg); }
            80% { transform: translateX(-51%) skew(1deg); }
            100% { transform: translateX(-50%) skew(0deg); }
        }

        /* Title */
        .game-title {
            font-family: var(--font-display);
            font-size: 5rem;
            text-align: center;
            margin-bottom: 0.5rem;
            background: var(--card-wild);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: none;
            filter: drop-shadow(3px 3px 0 rgba(0,0,0,0.3));
            letter-spacing: 5px;
            position: relative;
            z-index: 10;
        }
        
        .game-subtitle {
            font-family: var(--font-body);
            font-size: 1.5rem;
            color: var(--text);
            opacity: 0.8;
            margin-bottom: 3rem;
            text-align: center;
            position: relative;
            z-index: 10;
        }

        /* Buttons */
        .btn {
            padding: 1.2rem 3rem;
            font-size: 1.2rem;
            font-family: var(--font-display);
            letter-spacing: 2px;
            border: 3px solid var(--primary);
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s;
            text-transform: uppercase;
            position: relative;
            z-index: 10;
        }
        
        .btn-primary {
            background: var(--primary);
            color: white;
        }
        
        .btn-primary:hover {
            transform: scale(1.1) rotate(-2deg);
            box-shadow: 0 10px 40px var(--primary);
        }
        
        .btn-secondary {
            background: transparent;
            color: var(--text);
        }
        
        .btn-secondary:hover {
            background: var(--text);
            color: var(--bg-primary);
        }

        .menu-buttons {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
            z-index: 10;
        }

        /* Cards display */
        .cards-flying {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 300px;
            height: 200px;
            z-index: 1;
            opacity: 0.3;
            pointer-events: none;
        }
        
        .flying-card {
            position: absolute;
            width: 60px;
            height: 85px;
            border-radius: 8px;
            animation: flyAround 4s ease-in-out infinite;
        }
        
        .flying-card:nth-child(1) { top: 0; left: 20%; animation-delay: 0s; }
        .flying-card:nth-child(2) { top: 20%; left: 60%; animation-delay: 0.5s; }
        .flying-card:nth-child(3) { top: 60%; left: 30%; animation-delay: 1s; }
        .flying-card:nth-child(4) { top: 40%; left: 70%; animation-delay: 1.5s; }
        
        @keyframes flyAround {
            0%, 100% { transform: translate(0, 0) rotate(0deg); }
            25% { transform: translate(20px, -20px) rotate(10deg); }
            50% { transform: translate(-10px, 10px) rotate(-10deg); }
            75% { transform: translate(15px, 15px) rotate(5deg); }
        }

        /* Theme selection */
        .theme-showcase {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1.5rem;
            margin: 2rem 0;
            z-index: 10;
        }
        
        .theme-card {
            width: 200px;
            height: 150px;
            border-radius: 20px;
            cursor: pointer;
            overflow: hidden;
            position: relative;
            border: 4px solid transparent;
            transition: all 0.3s;
        }
        
        .theme-card:hover {
            transform: scale(1.1);
        }
        
        .theme-card.selected {
            border-color: var(--primary);
            box-shadow: 0 0 30px var(--primary);
        }
        
        .theme-card-bg {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
        }
        
        .theme-card-title {
            font-family: var(--font-display);
            font-size: 1.5rem;
            color: white;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
        }
        
        .theme-card-chars {
            font-size: 2.5rem;
            margin-top: 0.5rem;
        }

        /* Theme backgrounds */
        .theme-spider { background: linear-gradient(135deg, #1a0a2e, #ff00ff, #00d4ff); }
        .theme-milk { background: linear-gradient(135deg, #f5e6d3, #8b6914); }
        .theme-zoo { background: linear-gradient(135deg, #1a252f, #f39c12); }
        .theme-classic { background: linear-gradient(135deg, #1a1a2e, #e94560); }

        /* Character selector */
        .character-selector {
            display: flex;
            gap: 2rem;
            margin: 2rem 0;
            z-index: 10;
        }
        
        .char-option {
            width: 120px;
            height: 160px;
            border-radius: 15px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            border: 4px solid transparent;
            transition: all 0.3s;
            background: rgba(255,255,255,0.1);
        }
        
        .char-option:hover {
            transform: translateY(-10px);
        }
        
        .char-option.selected {
            border-color: var(--primary);
            box-shadow: 0 0 25px var(--primary);
        }
        
        .char-emoji {
            font-size: 4rem;
        }
        
        .char-name {
            font-family: var(--font-display);
            margin-top: 0.5rem;
            color: var(--text);
        }

        /* Input */
        .name-input {
            padding: 1rem 2rem;
            font-size: 1.2rem;
            border: 3px solid var(--primary);
            border-radius: 50px;
            background: rgba(255,255,255,0.1);
            color: var(--text);
            text-align: center;
            font-family: var(--font-body);
            margin: 1rem 0;
            width: 300px;
            z-index: 10;
        }
        
        .name-input::placeholder {
            color: var(--text);
            opacity: 0.5;
        }
        
        .name-input:focus {
            outline: none;
            background: rgba(255,255,255,0.2);
            box-shadow: 0 0 20px var(--primary);
        }

        /* Code display */
        .code-display {
            font-family: var(--font-display);
            font-size: 4rem;
            letter-spacing: 15px;
            color: var(--primary);
            padding: 1.5rem 3rem;
            background: rgba(0,0,0,0.3);
            border-radius: 20px;
            border: 3px solid var(--primary);
            margin: 1rem 0;
            z-index: 10;
            animation: codeGlow 2s ease-in-out infinite;
        }
        
        @keyframes codeGlow {
            0%, 100% { box-shadow: 0 0 20px var(--primary); }
            50% { box-shadow: 0 0 40px var(--primary), 0 0 60px var(--secondary); }
        }

        /* Join input */
        .join-input {
            font-family: var(--font-display);
            font-size: 2rem;
            letter-spacing: 10px;
            text-align: center;
            padding: 1rem;
            width: 250px;
            z-index: 10;
        }

        /* Cards in hand */
        .uno-card {
            width: 55px;
            height: 80px;
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: space-between;
            padding: 5px;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 3px 3px 10px rgba(0,0,0,0.5);
            position: relative;
        }
        
        .uno-card:hover {
            transform: translateY(-30px) scale(1.2);
            z-index: 100;
        }
        
        .uno-card.unplayable {
            opacity: 0.4;
            cursor: not-allowed;
        }
        
        .uno-card.unplayable:hover {
            transform: none;
        }
        
        .uno-card.red { background: var(--card-red); }
        .uno-card.blue { background: var(--card-blue); }
        .uno-card.green { background: var(--card-green); }
        .uno-card.yellow { background: var(--card-yellow); }
        .uno-card.wild { 
            background: var(--card-wild);
            color: white;
        }
        
        .card-val {
            font-family: var(--font-display);
            font-size: 1.2rem;
            color: white;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.8);
        }
        
        .card-center {
            font-size: 1.5rem;
        }

        /* Game area */
        .game-area {
            display: grid;
            grid-template-columns: 180px 1fr 180px;
            gap: 1rem;
            width: 100%;
            max-width: 1000px;
            flex: 1;
            z-index: 10;
        }
        
        .player-area {
            background: rgba(0,0,0,0.4);
            border-radius: 20px;
            padding: 1rem;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .play-area {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 1rem;
        }
        
        .deck {
            width: 70px;
            height: 100px;
            background: linear-gradient(135deg, #333, #555);
            border-radius: 10px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 5px 5px 20px rgba(0,0,0,0.5);
            transition: transform 0.3s;
        }
        
        .deck:hover {
            transform: scale(1.1);
        }
        
        .deck::before {
            content: 'UNO';
            font-family: var(--font-display);
            color: white;
            font-size: 1rem;
            transform: rotate(-45deg);
        }
        
        .discard {
            width: 70px;
            height: 100px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 5px 5px 20px rgba(0,0,0,0.5);
        }
        
        .discard .card-val {
            font-size: 2rem;
        }
        
        .hand {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 5px;
            margin-top: 1rem;
        }
        
        .opponent-hand {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 3px;
        }
        
        .card-back {
            width: 35px;
            height: 50px;
            background: linear-gradient(135deg, #222, #444);
            border-radius: 5px;
        }
        
        .turn-indicator {
            font-family: var(--font-display);
            font-size: 1.5rem;
            color: var(--primary);
            animation: pulse 1s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        /* Score header */
        .score-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
            max-width: 1000px;
            padding: 1rem 2rem;
            background: rgba(0,0,0,0.4);
            border-radius: 20px;
            margin-bottom: 1rem;
            z-index: 10;
        }
        
        .score-player {
            text-align: center;
        }
        
        .score-player .name {
            font-family: var(--font-display);
            font-size: 1.2rem;
            color: var(--text);
        }
        
        .score-player .points {
            font-family: var(--font-display);
            font-size: 2rem;
            color: var(--primary);
        }

        /* Color picker */
        .color-picker-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.9);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        
        .color-picker-overlay.active {
            display: flex;
        }
        
        .color-options {
            display: flex;
            gap: 1rem;
        }
        
        .color-btn {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            border: 5px solid white;
            cursor: pointer;
            transition: transform 0.3s;
        }
        
        .color-btn:hover {
            transform: scale(1.2);
        }

        /* Victory */
        .victory-screen {
            text-align: center;
        }
        
        .victory-text {
            font-family: var(--font-display);
            font-size: 5rem;
            background: var(--card-wild);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .victory-dance {
            font-size: 6rem;
            animation: dance 0.3s infinite alternate;
        }
        
        @keyframes dance {
            from { transform: rotate(-15deg); }
            to { transform: rotate(15deg); }
        }

        /* Mobile */
        @media (max-width: 768px) {
            .game-title { font-size: 3rem; }
            .game-area { grid-template-columns: 1fr; }
            .character-img { width: 80px; height: 80px; }
            .theme-card { width: 150px; height: 100px; }
            .code-display { font-size: 2.5rem; letter-spacing: 8px; }
        }
    </style>
</head>
<body data-theme="spiderverse">
    <!-- Character showcase for themed backgrounds -->
    <div class="character-showcase" id="charShow">
        <!-- Top character (opponent) -->
        <div class="character-top" id="charTop">
            <div class="character-name" id="charTopName">GWEN</div>
        </div>
        <!-- Bottom character (you) - shown as hands holding cards -->
        <div class="character-bottom" id="charBottom">
            <div class="character-name" id="charBottomName">MILES</div>
        </div>
    </div>
    
    <!-- Flying cards decoration -->
    <div class="cards-flying" id="flyingCards">
        <div class="flying-card red"></div>
        <div class="flying-card blue"></div>
        <div class="flying-card green"></div>
        <div class="flying-card yellow"></div>
    </div>
    
    <!-- WEB PATTERN FOR SPIDERVERSE -->
    <div class="spider-web" id="webPattern"></div>

    <!-- HOME SCREEN -->
    <div id="home-screen" class="screen active">
        <div class="game-title">üï∑Ô∏è UNO</div>
        <div class="game-subtitle">Couples Edition</div>
        
        <div class="menu-buttons">
            <button class="btn btn-primary" onclick="showScreen('setup-screen')">üéÆ PLAY</button>
            <button class="btn btn-secondary" onclick="showScreen('rules-screen')">üìñ RULES</button>
        </div>
    </div>

    <!-- SETUP SCREEN -->
    <div id="setup-screen" class="screen">
        <div class="game-title">WHO'S PLAYING?</div>
        
        <input type="text" class="name-input" id="playerName" placeholder="Your Name" maxlength="12">
        
        <div style="margin: 1rem 0; color: var(--text); font-family: var(--font-display);">PICK YOUR CHARACTER</div>
        
        <div class="character-selector" id="charSelector">
            <!-- Spiderverse characters -->
            <div class="char-option selected" data-char="miles" data-theme="spiderverse">
                <div class="char-emoji">üï∑Ô∏è</div>
                <div class="char-name">MILES</div>
            </div>
            <div class="char-option" data-char="gwen" data-theme="spiderverse">
                <div class="char-emoji">üëª</div>
                <div class="char-name">GWEN</div>
            </div>
            <!-- Milk & Mocha -->
            <div class="char-option" data-char="milk" data-theme="milk-mocha">
                <div class="char-emoji">üêª</div>
                <div class="char-name">MILK</div>
            </div>
            <div class="char-option" data-char="mocha" data-theme="milk-mocha">
                <div class="char-emoji">üß∏</div>
                <div class="char-name">MOCHA</div>
            </div>
            <!-- Zootopia -->
            <div class="char-option" data-char="judy" data-theme="zootopia">
                <div="zootopia class="char-emoji">üê∞</div>
                <div class="char-name">JUDY</div>
            </div>
            <div class="char-option" data-char="nick" data-theme="zootopia">
                <div class="char-emoji">ü¶ä</div>
                <div class="char-name">NICK</div>
            </div>
        </div>
        
        <input type="text" class="name-input" id="partnerName" placeholder="Partner's Name" maxlength="12">
        
        <div class="menu-buttons" style="margin-top: 2rem;">
            <button class="btn btn-primary" onclick="createGame()">CREATE GAME</button>
            <button class="btn btn-secondary" onclick="showScreen('home-screen')">BACK</button>
        </div>
    </div>

    <!-- RULES SCREEN -->
    <div id="rules-screen" class="screen">
        <div class="game-title" style="font-size: 3rem;">üìñ RULES</div>
        <div style="background: rgba(0,0,0,0.5); padding: 2rem; border-radius: 20px; max-width: 500px; color: var(--text); text-align: left;">
            <p style="margin-bottom: 1rem;"><strong>üéØ Goal:</strong> First to 500 points wins!</p>
            <p style="margin-bottom: 1rem;"><strong>üÉè Play:</strong> Match color or number</p>
            <p style="margin-bottom: 1rem;"><strong>‚è≠Ô∏è Skip:</strong> Opponent loses turn</p>
            <p style="margin-bottom: 1rem;"><strong>üîÑ Reverse:</strong> Changes direction (2-player = skip)</p>
            <p style="margin-bottom: 1rem;"><strong>‚ûï Draw 2:</strong> Opponent draws 2</p>
            <p style="margin-bottom: 1rem;"><strong>üåà Wild:</strong> Pick any color</p>
            <p style="margin-bottom: 1rem;"><strong>üåà+4 Wild:</strong> Pick color + opponent draws 4</p>
            <p><strong>üÖ∞Ô∏è UNO!</strong> Call when you have 1 card!</p>
        </div>
        <button class="btn btn-secondary" style="margin-top: 2rem;" onclick="showScreen('home-screen')">BACK</button>
    </div>

    <!-- PAIRING SCREEN -->
    <div id="pairing-screen" class="screen">
        <div class="game-title" style="font-size: 3rem;">üîó CONNECT</div>
        
        <p style="color: var(--text); margin-bottom: 1rem;">Share this code with your partner:</p>
        <div class="code-display" id="gameCode">------</div>
        
        <button class="btn btn-primary" onclick="copyCode()" style="margin-bottom: 2rem;">üìã COPY</button>
        
        <p style="color: var(--text); margin: 1rem 0;">OR join with code:</p>
        <input type="text" class="join-input" id="joinCode" placeholder="XXXXXX" maxlength="6">
        <button class="btn btn-secondary" onclick="joinGame()">JOIN</button>
        
        <p id="statusText" style="color: var(--primary); margin-top: 1rem;"></p>
    </div>

    <!-- GAME SCREEN -->
    <div id="game-screen" class="screen">
        <div class="score-header">
            <div class="score-player">
                <div class="name" id="p1Name">YOU</div>
                <div class="points" id="p1Points">0</div>
            </div>
            <div style="font-family: var(--font-display); font-size: 1.5rem; color: var(--text);">ROUND <span id="roundNum">1</span></div>
            <div class="score-player">
                <div class="name" id="p2Name">PARTNER</div>
                <div class="points" id="p2Points">0</div>
            </div>
        </div>
        
        <div class="game-area">
            <!-- Opponent -->
            <div class="player-area">
                <div style="font-size: 3rem;" id="oppAvatar">üëª</div>
                <div style="font-family: var(--font-display);" id="oppName">Partner</div>
                <div class="opponent-hand" id="oppHand"></div>
                <div style="color: var(--text); opacity: 0.7; margin-top: 0.5rem;" id="oppCount">7 cards</div>
            </div>
            
            <!-- Center -->
            <div class="play-area">
                <div style="display: flex; gap: 2rem; align-items: center;">
                    <div class="deck" onclick="drawCard()" id="drawDeck">
                        <span id="deckCount" style="position: absolute; bottom: -25px; font-family: var(--font-display); color: var(--text);">108</span>
                    </div>
                    <div class="discard" id="discardCard"></div>
                </div>
                <div class="turn-indicator" id="turnIndicator">YOUR TURN!</div>
            </div>
            
            <!-- You -->
            <div class="player-area">
                <div style="font-size: 3rem;" id="myAvatar">üï∑Ô∏è</div>
                <div style="font-family: var(--font-display);" id="myName">You</div>
                <div class="hand" id="myHand"></div>
            </div>
        </div>
    </div>

    <!-- VICTORY SCREEN -->
    <div id="victory-screen" class="screen victory-screen">
        <div class="victory-text" id="victoryText">YOU WIN!</div>
        <div class="victory-dance" id="victoryDance">üíÉüï∫</div>
        <div style="font-family: var(--font-display); font-size: 2rem; color: var(--text);" id="victoryPoints">+500 points</div>
        <div class="menu-buttons" style="margin-top: 2rem;">
            <button class="btn btn-primary" onclick="newRound()">NEXT ROUND</button>
            <button class="btn btn-secondary" onclick="showScreen('home-screen')">MENU</button>
        </div>
    </div>

    <!-- COLOR PICKER -->
    <div class="color-picker-overlay" id="colorPicker">
        <div style="text-align: center;">
            <div style="font-family: var(--font-display); font-size: 2rem; color: white; margin-bottom: 2rem;">CHOOSE COLOR</div>
            <div class="color-options">
                <button class="color-btn red" onclick="chooseWildColor('red')"></button>
                <button class="color-btn blue" onclick="chooseWildColor('blue')"></button>
                <button class="color-btn green" onclick="chooseWildColor('green')"></button>
                <button class="color-btn yellow" onclick="chooseWildColor('yellow')"></button>
            </div>
        </div>
    </div>

    <script>
        // ==================== GAME STATE ====================
        let state = {
            peer: null, conn: null, isHost: false,
            myName: '', myChar: '', myTheme: '',
            partnerName: '', partnerChar: '',
            myCards: [], deck: [], discard: [],
            myScore: 0, partnerScore: 0, round: 1,
            myTurn: true, direction: 1,
            currentColor: '', currentValue: '',
            pendingDraw: 0
        };

        const CHAR_DATA = {
            miles: { emoji: 'üï∑Ô∏è', name: 'MILES', theme: 'spiderverse', topEmoji: 'üëª', topName: 'GWEN' },
            gwen: { emoji: 'üëª', name: 'GWEN', theme: 'spiderverse', topEmoji: 'üï∑Ô∏è', topName: 'MILES' },
            milk: { emoji: 'üêª', name: 'MILK', theme: 'milk-mocha', topEmoji: 'üß∏', topName: 'MOCHA' },
            mocha: { emoji: 'üß∏', name: 'MOCHA', theme: 'milk-mocha', topEmoji: 'üêª', topName: 'MILK' },
            judy: { emoji: 'üê∞', name: 'JUDY', theme: 'zootopia', topEmoji: 'ü¶ä', topName: 'NICK' },
            nick: { emoji: 'ü¶ä', name: 'NICK', theme: 'zootopia', topEmoji: 'üê∞', topName: 'JUDY' }
        };

        // ==================== NAV ====================
        function showScreen(id) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(id).classList.add('active');
        }

        // ==================== SETUP ====================
        document.querySelectorAll('.char-option').forEach(opt => {
            opt.addEventListener('click', () => {
                document.querySelectorAll('.char-option').forEach(o => o.classList.remove('selected'));
                opt.classList.add('selected');
                state.myChar = opt.dataset.char;
                state.myTheme = opt.dataset.theme;
                applyTheme(state.myTheme);
            });
        });
        // Default
        applyTheme('spiderverse');

        function applyTheme(theme) {
            document.body.dataset.theme = theme;
            const webPattern = document.getElementById('webPattern');
            webPattern.style.display = theme === 'spiderverse' ? 'block' : 'none';
            
            // Update flying cards colors
            document.querySelectorAll('.flying-card').forEach((card, i) => {
                const colors = ['red', 'blue', 'green', 'yellow'];
                card.className = 'flying-card ' + colors[i];
            });
        }

        function createGame() {
            state.myName = document.getElementById('playerName').value || 'Player';
            const partnerName = document.getElementById('partnerName').value || 'Partner';
            
            const code = Math.random().toString(36).substring(2, 8).toUpperCase();
            state.isHost = true;
            
            state.peer = new Peer('uno-' + code);
            state.peer.on('open', () => {
                document.getElementById('gameCode').textContent = code;
            });
            state.peer.on('connection', conn => {
                state.conn = conn;
                setupConnection();
            });
            
            showScreen('pairing-screen');
        }

        function joinGame() {
            const code = document.getElementById('joinCode').value.toUpperCase();
            if (code.length !== 6) return;
            
            state.myName = document.getElementById('playerName').value || 'Player';
            state.isHost = false;
            
            state.peer = new Peer();
            state.peer.on('open', () => {
                state.conn = state.peer.connect('uno-' + code);
                setupConnection();
            });
            
            document.getElementById('statusText').textContent = 'Connecting...';
        }

        function copyCode() {
            navigator.clipboard.writeText(document.getElementById('gameCode').textContent);
            document.getElementById('statusText').textContent = 'Copied!';
        }

        function setupConnection() {
            state.conn.on('open', () => {
                document.getElementById('statusText').textContent = 'Connected!';
                setTimeout(startGame, 1000);
            });
            state.conn.on('data', handleMsg);
        }

        function send(type, data) {
            if (state.conn && state.conn.open) state.conn.send({ type, data });
        }

        // ==================== GAME ====================
        const COLORS = ['red', 'blue', 'green', 'yellow'];
        const VALUES = ['0','1','2','3','4','5','6','7','8','9','skip','reverse','draw2','wild','wild4'];

        function makeDeck() {
            let d = [];
            COLORS.forEach(c => {
                d.push({ c, v: '0', t: 'num' });
                for (let i = 1; i <= 9; i++) { d.push({ c, v: String(i), t: 'num' }); d.push({ c, v: String(i), t: 'num' }); }
                ['skip','reverse','draw2'].forEach(s => { d.push({ c, v: s, t: 'spec' }); d.push({ c, v: s, t: 'spec' }); });
            });
            for (let i = 0; i < 4; i++) { d.push({ c: 'wild', v: 'wild', t: 'wild' }); d.push({ c: 'wild', v: 'wild4', t: 'wild' }); }
            return d.sort(() => Math.random() - 0.5);
        }

        function startGame() {
            state.deck = makeDeck();
            state.myCards = state.deck.splice(0, 7);
            
            let first = state.deck.pop();
            while (first.c === 'wild') { state.deck.unshift(first); first = state.deck.pop(); }
            
            state.discard = [first];
            state.currentColor = first.c;
            state.currentValue = first.v;
            state.myTurn = state.isHost;
            
            const charInfo = CHAR_DATA[state.myChar] || CHAR_DATA.miles;
            state.partnerChar = charInfo.topEmoji === 'üï∑Ô∏è' ? 'gwen' : (charInfo.topEmoji === 'üëª' ? 'miles' : (charInfo.topEmoji === 'üêª' ? 'mocha' : (charInfo.topEmoji === 'üß∏' ? 'milk' : (charInfo.topEmoji === 'üê∞' ? 'nick' : 'judy'))));
            
            send('init', { name: state.myName, char: state.myChar, hand: state.myCards, first, hostFirst: state.isHost });
            
            if (!state.isHost) {
                // Wait for host data
            } else {
                // Host sends setup
            }
            
            updateUI();
            showScreen('game-screen');
        }

        function handleMsg(m) {
            switch(m.type) {
                case 'init':
                    state.partnerName = m.data.name;
                    state.partnerChar = m.data.char;
                    state.myCards = m.data.hand;
                    state.discard = [m.data.first];
                    state.currentColor = m.data.first.c;
                    state.currentValue = m.data.first.v;
                    state.myTurn = !m.data.hostFirst;
                    
                    const pInfo = CHAR_DATA[state.partnerChar];
                    state.myChar = m.data.char;
                    state.myTheme = pInfo.theme;
                    applyTheme(state.myTheme);
                    break;
                    
                case 'play':
                    const c = m.data.card;
                    state.discard.push(c);
                    state.currentColor = m.data.color;
                    state.currentValue = c.v;
                    state.partnerCardCount = m.data.count;
                    state.myTurn = true;
                    break;
                    
                case 'draw':
                    state.myCards.push(...m.data.cards);
                    state.myTurn = true;
                    break;
            }
            updateUI();
        }

        function canPlay(card) {
            if (state.pendingDraw > 0) return false;
            if (card.c === 'wild') return true;
            return card.c === state.currentColor || card.v === state.currentValue;
        }

        function playCard(idx) {
            if (!state.myTurn) return;
            const card = state.myCards[idx];
            if (!canPlay(card)) return;
            
            if (card.c === 'wild') {
                window.pendingIdx = idx;
                document.getElementById('colorPicker').classList.add('active');
                return;
            }
            
            execPlay(idx, card.c);
        }

        function chooseWildColor(color) {
            document.getElementById('colorPicker').classList.remove('active');
            const idx = window.pendingIdx;
            execPlay(idx, color);
            window.pendingIdx = null;
        }

        function execPlay(idx, color) {
            const card = state.myCards.splice(idx, 1)[0];
            state.discard.push(card);
            state.currentColor = color;
            state.currentValue = card.v;
            
            send('play', { card, color, count: state.myCards.length });
            
            if (state.myCards.length === 0) {
                endRound(true);
            }
            
            state.myTurn = false;
            updateUI();
        }

        function drawCard() {
            if (!state.myTurn) return;
            
            if (state.deck.length < 2) {
                const top = state.discard.pop();
                state.deck = state.discard.sort(() => Math.random() - 0.5);
                state.discard = [top];
            }
            
            const card = state.deck.pop();
            state.myCards.push(card);
            send('draw', { cards: [card] });
            
            if (!canPlay(card)) state.myTurn = false;
            updateUI();
        }

        function endRound(won) {
            let pts = 0;
            state.myCards.forEach(c => {
                if (c.v === 'wild' || c.v === 'wild4') pts += 50;
                else if (['skip','reverse','draw2'].includes(c.v)) pts += 20;
                else pts += parseInt(c.v) || 0;
            });
            
            if (won) state.myScore += pts;
            else state.partnerScore += pts;
            
            document.getElementById('victoryText').textContent = won ? 'YOU WIN!' : 'PARTNER WINS!';
            document.getElementById('victoryPoints').textContent = won ? `+${pts} points!` : `+0 points`;
            showScreen('victory-screen');
            
            // Confetti
            if (won) for (let i = 0; i < 50; i++) {
                setTimeout(() => {
                    const c = document.createElement('div');
                    c.style.cssText = `position:fixed;top:-10px;left:${Math.random()*100}vw;width:10px;height:10px;background:${['red','blue','green','yellow','purple'][Math.floor(Math.random()*5)]};animation:fly 2s linear forwards;z-index:9999;`;
                    document.body.appendChild(c);
                    setTimeout(()=>c.remove(),2000);
                }, i * 30);
            }
        }

        function newRound() {
            state.round++;
            startGame();
        }

        // ==================== UI ====================
        function updateUI() {
            const myChar = CHAR_DATA[state.myChar] || CHAR_DATA.miles;
            const partnerChar = CHAR_DATA[state.partnerChar] || CHAR_DATA.gwen;
            
            // Update character display
            document.getElementById('charTopName').textContent = partnerChar.name;
            document.getElementById('charBottomName').textContent = state.myName;
            
            // Header
            document.getElementById('p1Name').textContent = state.myName;
            document.getElementById('p2Name').textContent = state.partnerName || 'Partner';
            document.getElementById('p1Points').textContent = state.myScore;
            document.getElementById('p2Points').textContent = state.partnerScore;
            document.getElementById('roundNum').textContent = state.round;
            
            // Avatars
            document.getElementById('myAvatar').textContent = myChar.emoji;
            document.getElementById('oppAvatar').textContent = partnerChar.emoji;
            document.getElementById('myName').textContent = 'YOU';
            document.getElementById('oppName').textContent = state.partnerName || 'Partner';
            
            // Discard
            const top = state.discard[state.discard.length - 1];
            const discardEl = document.getElementById('discardCard');
            discardEl.className = 'discard ' + top.c;
            discardEl.innerHTML = `<span class="card-val">${getVal(top)}</span>`;
            
            // Deck
            document.getElementById('deckCount').textContent = state.deck.length;
            
            // Turn
            document.getElementById('turnIndicator').textContent = state.myTurn ? "YOUR TURN!" : "THEIR TURN...";
            document.getElementById('turnIndicator').style.color = state.myTurn ? 'var(--primary)' : 'var(--text)';
            
            // Hand
            const handEl = document.getElementById('myHand');
            handEl.innerHTML = '';
            state.myCards.forEach((c, i) => {
                const card = document.createElement('div');
                card.className = 'uno-card ' + c.c;
                if (!canPlay(c) && state.myTurn) card.classList.add('unplayable');
                card.innerHTML = `<span class="card-val">${getVal(c)}</span><span class="card-center">${getIcon(c)}</span>`;
                card.onclick = () => playCard(i);
                handEl.appendChild(card);
            });
            
            // Opponent hand
            const oppHand = document.getElementById('oppHand');
            oppHand.innerHTML = '';
            const oppCount = state.partnerCardCount || 7;
            document.getElementById('oppCount').textContent = oppCount + ' cards';
            for (let i = 0; i < Math.min(oppCount, 8); i++) {
                const back = document.createElement('div');
                back.className = 'card-back';
                oppHand.appendChild(back);
            }
        }

        function getVal(c) {
            if (c.v === 'skip') return '‚äò';
            if (c.v === 'reverse') return '‚áÑ';
            if (c.v === 'draw2') return '+2';
            if (c.v === 'wild') return 'üåà';
            if (c.v === 'wild4') return '+4';
            return c.v;
        }

        function getIcon(c) {
            if (c.v === 'skip') return '‚è≠';
            if (c.v === 'reverse') return 'üîÑ';
            if (c.v === 'draw2') return '++';
            if (c.c === 'wild') return 'üåà';
            return '';
        }

        // Add CSS for confetti
        const style = document.createElement('style');
        style.textContent = `@keyframes fly { to { transform: translateY(100vh) rotate(720deg); } }`;
        document.head.appendChild(style);
    </script>
</body>
</html>
